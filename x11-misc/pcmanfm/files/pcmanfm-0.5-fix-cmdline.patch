From 52c1be03ec7b7ec7498b210f625b3e1798edab4b Mon Sep 17 00:00:00 2001
From: Sebastian Pipping <sebastian@pipping.org>
Date: Thu, 26 Mar 2009 22:42:37 +0100
Subject: [PATCH 1/3] Make it so that relative paths in the command line get resolved against $PWD, not $HOME

---
 src/main.c |   16 ++++++++++++++--
 1 files changed, 14 insertions(+), 2 deletions(-)

diff --git a/src/main.c b/src/main.c
index ca77ae2..d0cb7b4 100644
--- a/src/main.c
+++ b/src/main.c
@@ -27,6 +27,8 @@
 
 #include <signal.h>
 
+#include <unistd.h> /* for getcwd */
+
 #include "main-window.h"
 
 #include "vfs-file-info.h"
@@ -560,7 +562,8 @@ gboolean handle_parsed_commandline_args()
             /* open files passed in command line arguments */
             for( file = files; *file; ++file )
             {
-                char* file_path, *real_path;
+                char* file_path, *real_path, *cwd_path;
+                const size_t cwd_size = PATH_MAX;
 
                 if( ! **file )  /* skip empty string */
                     continue;
@@ -574,7 +577,16 @@ gboolean handle_parsed_commandline_args()
                 else
                     file_path = *file;
 
-                real_path = vfs_file_resolve_path( NULL, file_path );
+                cwd_path = malloc( cwd_size );
+                if( cwd_path )
+                {
+                    getcwd( cwd_path, cwd_size );
+                }
+
+                real_path = vfs_file_resolve_path( cwd_path, file_path );
+                free( cwd_path );
+                cwd_path = NULL;
+
                 if( g_file_test( real_path, G_FILE_TEST_IS_DIR ) )
                 {
                     if( G_UNLIKELY( ! main_window ) )   /* create main window if needed */
-- 
9999.20090323.91408042768c

